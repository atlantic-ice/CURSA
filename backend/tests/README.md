# Система тестирования для нормоконтроля документов DOCX

## Обзор

Система тестирования для проекта нормоконтроля документов DOCX предназначена для проверки всех аспектов работы системы, от проверки форматирования документов до API взаимодействия. Тесты обеспечивают уверенность в работоспособности ключевых функций системы нормоконтроля.

## Структура тестов

Система тестирования включает следующие компоненты:

1. **Генератор тестовых данных** (`test_data_generator.py`)
   - Создает различные DOCX документы с заданными ошибками форматирования
   - Поддерживает генерацию документов с разными типами ошибок: шрифт, размер шрифта, поля, межстрочный интервал и т.д.

2. **Функциональные тесты** (`functional/`)
   - `test_document_processing.py` - тесты обработки и проверки форматирования документов
   - `test_document_api.py` - тесты API для загрузки, проверки, исправления и скачивания документов

3. **Модульные тесты** (`unit/`)
   - `test_document_processor.py` - тесты класса DocumentProcessor
   - `test_norm_control_checker.py` - тесты класса NormControlChecker

4. **Интеграционные тесты** (`integration/`)
   - `test_document_flow.py` - тесты полного цикла работы с документом от загрузки до скачивания

5. **Тестовые данные** (`test_data/`)
   - Набор тестовых документов для различных сценариев тестирования
   - Директория `results/` для сохранения результатов тестирования
   - Директория `results/html_reports/` для HTML-отчетов с визуализацией

6. **Генераторы отчетов**
   - `generate_report.py` - генерация текстовых отчетов о результатах тестирования
   - `generate_html_report.py` - генерация HTML-отчетов с графиками и диаграммами

7. **Инструменты анализа покрытия**
   - `run_coverage.bat`/`.sh` - запуск тестов с анализом покрытия кода

## Запуск тестов

### Все тесты

#### Windows

```
backend\run_all_tests.bat
```

#### Linux/macOS

```
bash backend/run_all_tests.sh
```

### Только модульные тесты

#### Windows

```
backend\run_unit_tests.bat
```

#### Linux/macOS

```
bash backend/run_unit_tests.sh
```

### Только интеграционные тесты

#### Windows

```
backend\run_integration_tests.bat
```

#### Linux/macOS

```
bash backend/run_integration_tests.sh
```

### Анализ покрытия кода тестами

#### Windows

```
backend\run_coverage.bat
```

#### Linux/macOS

```
bash backend/run_coverage.sh
```

### Опции запуска

При запуске скриптов доступны следующие опции:

- Запустить все тесты (по умолчанию)
- Запустить только функциональные тесты: `pytest backend/tests/functional`
- Запустить только API тесты: `pytest backend/tests/functional/test_document_api.py`
- Запустить только генерацию тестовых документов: `python backend/tests/test_data_generator.py -a`
- Запустить интеграционные тесты: `pytest backend/tests/integration -m integration`
- Сгенерировать HTML-отчет: `python backend/tests/generate_html_report.py`

## Результаты тестирования

Все результаты тестирования сохраняются в следующих директориях:

- `backend/tests/test_data/results/` - JSON-файлы с результатами
  - `test_results.json` - результаты функциональных тестов
  - `api_test_results.json` - результаты API тестов
  - `unit_test_results.json` - результаты модульных тестов
  - `test_report_*.txt` - текстовые отчеты о результатах тестирования

- `backend/tests/test_data/results/html_reports/` - HTML-отчеты с визуализацией
  - `report_*.html` - HTML-отчет с графиками и таблицами

- `htmlcov/` - отчеты о покрытии кода тестами
  - `index.html` - главная страница отчета о покрытии

## Визуализация результатов

HTML-отчеты включают следующие элементы:

1. **Общая статистика** - сводная информация о количестве успешных и неуспешных тестов
2. **Круговая диаграмма** - визуализация соотношения успешных и неуспешных тестов
3. **Столбчатая диаграмма** - процент успешных тестов по категориям
4. **Детальная таблица** - подробные результаты всех выполненных тестов

## Покрытие тестами

Текущая система тестирования охватывает следующие аспекты:

1. **Проверка документов**:
   - Шрифт (тип, размер)
   - Поля страницы
   - Межстрочный интервал
   - Отступы абзацев

2. **Исправление документов**:
   - Автоматическое исправление ошибок форматирования
   - Проверка качества исправленных документов

3. **API**:
   - Загрузка документов
   - Проверка документов на соответствие требованиям
   - Исправление ошибок
   - Скачивание исправленных документов

4. **Интеграционное тестирование**:
   - Полный цикл работы с документом
   - Обработка ошибочных сценариев

## Статистика

В последнем запуске тестов (на момент создания документации):
- Всего тестов: 82
- Успешно: 74 (90.2%)
- Не пройдено: 8 (9.8%)

### Результаты по категориям:
- Проверка шрифта: 100.0% успешно
- Проверка размера шрифта: 100.0% успешно
- Проверка полей страницы: 100.0% успешно
- Проверка межстрочного интервала: 100.0% успешно
- Автоматическое исправление документа: 100.0% успешно
- Загрузка документа: 100.0% успешно
- Проверка исправленного документа: 27.3% успешно

## Известные проблемы

1. В категории "Проверка исправленного документа" тесты показывают низкий процент успешности (27.3%). 
   Причина: автоматическое исправление не устраняет все ошибки форматирования, что требует ручной корректировки.

2. При тестировании API скачивания файлов возникают проблемы с перенаправлением, решенные путем проверки как прямой отдачи файлов, так и корректности перенаправления. 